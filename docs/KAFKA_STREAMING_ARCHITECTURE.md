# ğŸŒŠ Kafka Kraft å®æ—¶æ•°æ®æµå¤„ç†åº”ç”¨æ¶æ„

## ğŸ¯ **æ¦‚è¿°**

åœ¨ Chicago Taxi MLOps å¹³å°ä¸­ï¼ŒKafka Kraft å®æ—¶æ•°æ®æµå¤„ç†æ‰®æ¼”ç€æ•°æ®æµè½¬çš„æ ¸å¿ƒè§’è‰²ï¼Œè¿æ¥æ•°æ®é‡‡é›†ã€ç‰¹å¾å·¥ç¨‹ã€æ¨¡å‹æ¨ç†ã€ç›‘æ§å‘Šè­¦ç­‰å„ä¸ªç¯èŠ‚ï¼Œå®ç°çœŸæ­£çš„ç«¯åˆ°ç«¯å®æ—¶ MLOpsã€‚

---

## ğŸ—ï¸ **æ•´ä½“æ¶æ„**

```
æ•°æ®æº â†’ Kafka Topics â†’ æµå¤„ç†å™¨ â†’ åº”ç”¨æ¶ˆè´¹è€…
  â†“         â†“           â†“         â†“
å‡ºç§Ÿè½¦    å®æ—¶æ•°æ®     ç‰¹å¾å·¥ç¨‹   æ¨¡å‹æ¨ç†
GPSæ•°æ®   äº‹ä»¶æµ      æ•°æ®æ¸…æ´—   ç›‘æ§å‘Šè­¦
è®¢å•æ•°æ®  æ¶ˆæ¯é˜Ÿåˆ—    ç‰¹å¾è®¡ç®—   ä»ªè¡¨æ¿æ›´æ–°
```

---

## ğŸ“Š **æ ¸å¿ƒåº”ç”¨åœºæ™¯**

### 1. **å®æ—¶ç‰¹å¾å·¥ç¨‹**
- **åŸå§‹æ•°æ®æµ** â†’ **ç‰¹å¾è®¡ç®—** â†’ **ç‰¹å¾å­˜å‚¨(Feast)**
- å®æ—¶è®¡ç®—è¡Œç¨‹è·ç¦»ã€æ—¶é—´ç‰¹å¾ã€åœ°ç†ä½ç½®ç‰¹å¾
- æ»‘åŠ¨çª—å£èšåˆï¼šè¿‡å»1å°æ—¶/24å°æ—¶çš„ç»Ÿè®¡ç‰¹å¾

### 2. **åœ¨çº¿æ¨¡å‹æ¨ç†**
- **ç‰¹å¾æµ** â†’ **æ¨¡å‹é¢„æµ‹** â†’ **ç»“æœåˆ†å‘**
- å®æ—¶è´¹ç”¨é¢„æµ‹ã€å°è´¹é¢„æµ‹ã€éœ€æ±‚é¢„æµ‹
- ä½å»¶è¿Ÿæ¨ç†æœåŠ¡é›†æˆ

### 3. **æ•°æ®è´¨é‡ç›‘æ§**
- **æ•°æ®æµ** â†’ **è´¨é‡æ£€æµ‹** â†’ **å‘Šè­¦ç³»ç»Ÿ**
- å®æ—¶æ•°æ®æ¼‚ç§»æ£€æµ‹ã€å¼‚å¸¸å€¼ç›‘æ§
- è‡ªåŠ¨è§¦å‘æ¨¡å‹é‡è®­ç»ƒæµç¨‹

### 4. **ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§**
- **é¢„æµ‹ç»“æœæµ** â†’ **æŒ‡æ ‡è®¡ç®—** â†’ **ä»ªè¡¨æ¿æ›´æ–°**
- å®æ—¶æ¨¡å‹æ€§èƒ½ç›‘æ§ã€ä¸šåŠ¡KPIè¿½è¸ª
- PrometheusæŒ‡æ ‡æ¨é€ã€Grafanaå¯è§†åŒ–

---

## ğŸ”„ **æ•°æ®æµå¤„ç†ç®¡é“**

### Topic è®¾è®¡

#### 1. **åŸå§‹æ•°æ® Topics**
```yaml
taxi-rides-raw:
  description: "åŸå§‹å‡ºç§Ÿè½¦è¡Œç¨‹æ•°æ®"
  partitions: 6
  replication: 1
  schema:
    - trip_id: string
    - pickup_datetime: timestamp
    - pickup_latitude: float
    - pickup_longitude: float
    - dropoff_latitude: float
    - dropoff_longitude: float
    - passenger_count: int
    - trip_distance: float
    - fare_amount: float
    - payment_type: string
    - company: string

taxi-gps-stream:
  description: "å®æ—¶GPSä½ç½®æ•°æ®"
  partitions: 12
  replication: 1
  schema:
    - vehicle_id: string
    - timestamp: timestamp
    - latitude: float
    - longitude: float
    - speed: float
    - heading: float
```

#### 2. **ç‰¹å¾æ•°æ® Topics**
```yaml
taxi-features-realtime:
  description: "å®æ—¶è®¡ç®—çš„ç‰¹å¾æ•°æ®"
  partitions: 6
  replication: 1
  schema:
    - trip_id: string
    - timestamp: timestamp
    - pickup_hour: int
    - pickup_day_of_week: int
    - pickup_community_area: int
    - trip_duration_seconds: int
    - trip_distance_miles: float
    - avg_speed_mph: float
    - weather_condition: string
    - demand_level: string

taxi-features-aggregated:
  description: "èšåˆç‰¹å¾æ•°æ®"
  partitions: 3
  replication: 1
  schema:
    - area_id: string
    - time_window: string
    - avg_trip_duration: float
    - trip_count: int
    - avg_fare: float
    - demand_score: float
```

#### 3. **é¢„æµ‹ç»“æœ Topics**
```yaml
taxi-predictions:
  description: "æ¨¡å‹é¢„æµ‹ç»“æœ"
  partitions: 6
  replication: 1
  schema:
    - trip_id: string
    - timestamp: timestamp
    - predicted_fare: float
    - predicted_tip: float
    - confidence_score: float
    - model_version: string

taxi-anomalies:
  description: "å¼‚å¸¸æ£€æµ‹ç»“æœ"
  partitions: 3
  replication: 1
  schema:
    - trip_id: string
    - timestamp: timestamp
    - anomaly_type: string
    - anomaly_score: float
    - details: json
```

#### 4. **ç›‘æ§å‘Šè­¦ Topics**
```yaml
model-metrics:
  description: "æ¨¡å‹æ€§èƒ½æŒ‡æ ‡"
  partitions: 3
  replication: 1
  schema:
    - model_name: string
    - timestamp: timestamp
    - metric_name: string
    - metric_value: float
    - threshold: float

data-quality-alerts:
  description: "æ•°æ®è´¨é‡å‘Šè­¦"
  partitions: 3
  replication: 1
  schema:
    - alert_id: string
    - timestamp: timestamp
    - alert_type: string
    - severity: string
    - message: string
    - affected_features: array
```

---

## ğŸ”§ **æµå¤„ç†å™¨å®ç°**

### 1. **å®æ—¶ç‰¹å¾å·¥ç¨‹å¤„ç†å™¨**
```python
# å¤„ç†åŸå§‹æ•°æ®ï¼Œç”Ÿæˆå®æ—¶ç‰¹å¾
taxi-rides-raw â†’ [ç‰¹å¾è®¡ç®—] â†’ taxi-features-realtime
```

### 2. **èšåˆç‰¹å¾å¤„ç†å™¨**
```python
# æ—¶é—´çª—å£èšåˆï¼Œç”ŸæˆåŒºåŸŸ/æ—¶é—´ç»´åº¦ç‰¹å¾
taxi-rides-raw â†’ [çª—å£èšåˆ] â†’ taxi-features-aggregated
```

### 3. **æ¨¡å‹æ¨ç†å¤„ç†å™¨**
```python
# æ¶ˆè´¹ç‰¹å¾æ•°æ®ï¼Œè¿›è¡Œå®æ—¶é¢„æµ‹
taxi-features-realtime â†’ [æ¨¡å‹æ¨ç†] â†’ taxi-predictions
```

### 4. **å¼‚å¸¸æ£€æµ‹å¤„ç†å™¨**
```python
# æ•°æ®è´¨é‡ç›‘æ§å’Œå¼‚å¸¸æ£€æµ‹
taxi-rides-raw + taxi-predictions â†’ [å¼‚å¸¸æ£€æµ‹] â†’ taxi-anomalies
```

### 5. **æŒ‡æ ‡è®¡ç®—å¤„ç†å™¨**
```python
# è®¡ç®—ä¸šåŠ¡å’Œæ¨¡å‹æŒ‡æ ‡
taxi-predictions â†’ [æŒ‡æ ‡è®¡ç®—] â†’ model-metrics
```

---

## ğŸ¯ **å…·ä½“åº”ç”¨åœºæ™¯**

### åœºæ™¯1: å®æ—¶è´¹ç”¨é¢„æµ‹æœåŠ¡
```
1. ç”¨æˆ·é€šè¿‡ App è¯·æ±‚è¡Œç¨‹ â†’ Kafka (taxi-ride-requests)
2. æµå¤„ç†å™¨è®¡ç®—å®æ—¶ç‰¹å¾ â†’ Kafka (taxi-features-realtime)
3. æ¨¡å‹æ¨ç†æœåŠ¡æ¶ˆè´¹ç‰¹å¾ â†’ ç”Ÿæˆé¢„æµ‹ç»“æœ
4. é¢„æµ‹ç»“æœå‘å¸ƒåˆ° Kafka (taxi-predictions)
5. FastAPI æœåŠ¡æ¶ˆè´¹ç»“æœ â†’ è¿”å›ç»™ç”¨æˆ·
```

### åœºæ™¯2: å®æ—¶æ•°æ®è´¨é‡ç›‘æ§
```
1. åŸå§‹æ•°æ®æµå…¥ â†’ Kafka (taxi-rides-raw)
2. æ•°æ®è´¨é‡æ£€æµ‹å™¨æ¶ˆè´¹æ•°æ® â†’ æ£€æµ‹å¼‚å¸¸å’Œæ¼‚ç§»
3. å¼‚å¸¸ç»“æœå‘å¸ƒåˆ° Kafka (data-quality-alerts)
4. ç›‘æ§ç³»ç»Ÿæ¶ˆè´¹å‘Šè­¦ â†’ è§¦å‘ Prometheus å‘Šè­¦
5. Grafana ä»ªè¡¨æ¿å®æ—¶æ›´æ–° â†’ è¿ç»´å›¢é˜Ÿæ”¶åˆ°é€šçŸ¥
```

### åœºæ™¯3: åŠ¨æ€éœ€æ±‚é¢„æµ‹
```
1. GPS æ•°æ®æµ â†’ Kafka (taxi-gps-stream)
2. åŒºåŸŸèšåˆå¤„ç†å™¨ â†’ è®¡ç®—å„åŒºåŸŸå®æ—¶éœ€æ±‚
3. éœ€æ±‚é¢„æµ‹ç»“æœ â†’ Kafka (demand-predictions)
4. è°ƒåº¦ç³»ç»Ÿæ¶ˆè´¹é¢„æµ‹ â†’ ä¼˜åŒ–è½¦è¾†åˆ†é…
5. Streamlit UI æ˜¾ç¤ºçƒ­åŠ›å›¾ â†’ å®æ—¶éœ€æ±‚å¯è§†åŒ–
```

### åœºæ™¯4: æ¨¡å‹æ€§èƒ½ç›‘æ§
```
1. é¢„æµ‹ç»“æœæµ â†’ Kafka (taxi-predictions)
2. å®é™…ç»“æœæµ â†’ Kafka (taxi-actuals)
3. æ€§èƒ½è®¡ç®—å¤„ç†å™¨ â†’ è®¡ç®— MAEã€RMSE ç­‰æŒ‡æ ‡
4. æŒ‡æ ‡å‘å¸ƒ â†’ Kafka (model-metrics)
5. Prometheus æ¶ˆè´¹æŒ‡æ ‡ â†’ Grafana å±•ç¤ºæ€§èƒ½è¶‹åŠ¿
```

---

## ğŸ’¡ **æµå¤„ç†ç»“æœçš„å…·ä½“åº”ç”¨**

### 1. **FastAPI æœåŠ¡é›†æˆ**
- **å®æ—¶é¢„æµ‹ç«¯ç‚¹**: æ¶ˆè´¹é¢„æµ‹ç»“æœï¼Œæä¾›ä½å»¶è¿ŸAPIå“åº”
- **æ‰¹é‡å¤„ç†ç«¯ç‚¹**: æ¶ˆè´¹èšåˆç‰¹å¾ï¼Œæ”¯æŒæ‰¹é‡é¢„æµ‹
- **ç›‘æ§ç«¯ç‚¹**: æ¶ˆè´¹æŒ‡æ ‡æ•°æ®ï¼Œæä¾›æœåŠ¡å¥åº·çŠ¶æ€

### 2. **Streamlit UI é›†æˆ**
- **å®æ—¶ä»ªè¡¨æ¿**: æ¶ˆè´¹å„ç±»æŒ‡æ ‡ï¼Œå±•ç¤ºå®æ—¶ä¸šåŠ¡çŠ¶æ€
- **é¢„æµ‹ç»“æœå±•ç¤º**: å®æ—¶æ›´æ–°é¢„æµ‹ç»“æœå’Œç½®ä¿¡åº¦
- **å¼‚å¸¸å‘Šè­¦ç•Œé¢**: æ˜¾ç¤ºæ•°æ®è´¨é‡é—®é¢˜å’Œæ¨¡å‹å¼‚å¸¸

### 3. **TFX Pipeline é›†æˆ**
- **è§¦å‘é‡è®­ç»ƒ**: æ¶ˆè´¹æ•°æ®è´¨é‡å‘Šè­¦ï¼Œè‡ªåŠ¨è§¦å‘æ¨¡å‹é‡è®­ç»ƒ
- **ç‰¹å¾éªŒè¯**: å®æ—¶ç‰¹å¾æ•°æ®ç”¨äºåœ¨çº¿ç‰¹å¾éªŒè¯
- **æ¨¡å‹è¯„ä¼°**: å®æ—¶é¢„æµ‹ç»“æœç”¨äºæŒç»­æ¨¡å‹è¯„ä¼°

### 4. **Feast ç‰¹å¾å­˜å‚¨é›†æˆ**
- **åœ¨çº¿ç‰¹å¾æœåŠ¡**: å®æ—¶ç‰¹å¾æ•°æ®æ¨é€åˆ° Feast åœ¨çº¿å­˜å‚¨
- **ç‰¹å¾ç›‘æ§**: ç‰¹å¾åˆ†å¸ƒå˜åŒ–ç›‘æ§å’Œå‘Šè­¦
- **ç‰¹å¾è¡€ç¼˜è¿½è¸ª**: è¿½è¸ªç‰¹å¾ä»åŸå§‹æ•°æ®åˆ°åº”ç”¨çš„å®Œæ•´é“¾è·¯

### 5. **ç›‘æ§ç³»ç»Ÿé›†æˆ**
- **Prometheus æŒ‡æ ‡**: æµå¤„ç†æŒ‡æ ‡æ¨é€åˆ° Prometheus
- **Grafana å¯è§†åŒ–**: å®æ—¶æ•°æ®æµç›‘æ§ä»ªè¡¨æ¿
- **Loki æ—¥å¿—**: æµå¤„ç†æ—¥å¿—èšåˆå’ŒæŸ¥è¯¢

---

## ğŸš€ **æ€§èƒ½ä¼˜åŒ–**

### 1. **åˆ†åŒºç­–ç•¥**
- æŒ‰åœ°ç†åŒºåŸŸåˆ†åŒºï¼Œæé«˜å¹¶è¡Œå¤„ç†èƒ½åŠ›
- æŒ‰æ—¶é—´åˆ†åŒºï¼Œæ”¯æŒæ—¶åºæ•°æ®å¤„ç†

### 2. **æ‰¹å¤„ç†ä¼˜åŒ–**
- å¾®æ‰¹å¤„ç†ï¼Œå¹³è¡¡å»¶è¿Ÿå’Œååé‡
- åŠ¨æ€æ‰¹å¤§å°è°ƒæ•´ï¼Œé€‚åº”æµé‡å˜åŒ–

### 3. **çŠ¶æ€ç®¡ç†**
- åˆ†å¸ƒå¼çŠ¶æ€å­˜å‚¨ï¼Œæ”¯æŒçª—å£èšåˆ
- æ£€æŸ¥ç‚¹æœºåˆ¶ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§

### 4. **å®¹é”™æœºåˆ¶**
- æ¶ˆæ¯é‡è¯•ç­–ç•¥ï¼Œå¤„ç†ä¸´æ—¶æ•…éšœ
- æ­»ä¿¡é˜Ÿåˆ—ï¼Œå¤„ç†æ— æ³•å¤„ç†çš„æ¶ˆæ¯

---

## ğŸ“ˆ **ä¸šåŠ¡ä»·å€¼**

### 1. **å®æ—¶å“åº”**
- æ¯«ç§’çº§é¢„æµ‹å“åº”ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- å®æ—¶éœ€æ±‚æ„ŸçŸ¥ï¼Œä¼˜åŒ–èµ„æºé…ç½®

### 2. **æ•°æ®è´¨é‡ä¿éšœ**
- å®æ—¶æ•°æ®ç›‘æ§ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- è‡ªåŠ¨åŒ–è´¨é‡æ£€æµ‹ï¼Œå‡å°‘äººå·¥å¹²é¢„

### 3. **æ¨¡å‹æ€§èƒ½ä¼˜åŒ–**
- æŒç»­æ€§èƒ½ç›‘æ§ï¼ŒåŠæ—¶å‘ç°æ¨¡å‹é€€åŒ–
- è‡ªåŠ¨åŒ–é‡è®­ç»ƒè§¦å‘ï¼Œä¿æŒæ¨¡å‹æ–°é²œåº¦

### 4. **è¿è¥æ•ˆç‡æå‡**
- å®æ—¶ä¸šåŠ¡æŒ‡æ ‡ï¼Œæ”¯æŒå¿«é€Ÿå†³ç­–
- å¼‚å¸¸è‡ªåŠ¨å‘Šè­¦ï¼Œå‡å°‘ç³»ç»Ÿåœæœºæ—¶é—´

---

## ğŸ”§ **æŠ€æœ¯æ ˆ**

### æ ¸å¿ƒç»„ä»¶
- **Kafka Kraft**: æ¶ˆæ¯é˜Ÿåˆ—å’Œæµå¤„ç†å¹³å°
- **Kafka Streams**: æµå¤„ç†æ¡†æ¶
- **Schema Registry**: æ•°æ®æ¨¡å¼ç®¡ç†
- **Kafka Connect**: æ•°æ®é›†æˆè¿æ¥å™¨

### é›†æˆç»„ä»¶
- **FastAPI**: REST API æœåŠ¡
- **Streamlit**: å®æ—¶ä»ªè¡¨æ¿
- **TFX**: ML Pipeline é›†æˆ
- **Feast**: ç‰¹å¾å­˜å‚¨
- **Prometheus/Grafana**: ç›‘æ§å¯è§†åŒ–

---

## ğŸ¯ **æ€»ç»“**

Kafka Kraft å®æ—¶æ•°æ®æµå¤„ç†åœ¨ Chicago Taxi MLOps å¹³å°ä¸­å®ç°äº†ï¼š

âœ… **ç«¯åˆ°ç«¯æ•°æ®æµ**: ä»åŸå§‹æ•°æ®åˆ°ä¸šåŠ¡åº”ç”¨çš„å®Œæ•´é“¾è·¯  
âœ… **å®æ—¶ç‰¹å¾å·¥ç¨‹**: æ¯«ç§’çº§ç‰¹å¾è®¡ç®—å’Œåˆ†å‘  
âœ… **åœ¨çº¿æ¨¡å‹æ¨ç†**: ä½å»¶è¿Ÿé¢„æµ‹æœåŠ¡  
âœ… **æŒç»­è´¨é‡ç›‘æ§**: å®æ—¶æ•°æ®å’Œæ¨¡å‹ç›‘æ§  
âœ… **è‡ªåŠ¨åŒ–è¿ç»´**: å¼‚å¸¸æ£€æµ‹å’Œè‡ªåŠ¨åŒ–å“åº”  
âœ… **ä¸šåŠ¡ä»·å€¼æœ€å¤§åŒ–**: å®æ—¶å†³ç­–æ”¯æŒå’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–  

é€šè¿‡ Kafka æµå¤„ç†ï¼Œæ•´ä¸ª MLOps å¹³å°å®ç°äº†çœŸæ­£çš„å®æ—¶åŒ–å’Œè‡ªåŠ¨åŒ–ï¼ğŸš€
